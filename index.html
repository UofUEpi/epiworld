<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>epiworld: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">epiworld
   &#160;<span id="projectnumber">0.0-1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">epiworld Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a href="https://github.com/UofUEpi/epiworld/actions/workflows/ci.yml"><img src="https://github.com/UofUEpi/epiworld/actions/workflows/ci.yml/badge.svg" alt="Tests and coverage" style="pointer-events: none;" class="inline"/></a> <a href="https://UofUEpi.github.io/epiworld"><img src="https://img.shields.io/badge/Docs-Doxygen-brightgreen" alt="C++ Documentation" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
epiworld</h1>
<p>This C++ library provides a general framework for epidemiologic simulation. The core principle of <code>epiworld</code> is fast epidemiological prototyping for building complex models quickly. Here are some of its main features:</p>
<ul>
<li>It only depends on the standard library (C++11 required.)</li>
<li>It is a template library.</li>
<li>It is header-only (<a href="epiworld.hpp">single file</a>).</li>
<li>Models can have an arbitrary set of states.</li>
<li><a class="el" href="class_viruses.html" title="Set of viruses (useful for building iterators)">Viruses</a> and tools (e.g., vaccines, mask-wearing) can be designed to have arbitrary features.</li>
<li>Multiple tools and viruses can live in the same simulation.</li>
<li>It is <em>FAST</em>: About 7.5 Million person/day simulations per second (see example below).</li>
</ul>
<p>Various examples can be found in the [examples](examples) folder.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Hello world</h2>
<p>Here is a simple SIR model implemented with <code>epiworld</code>. The source code can be found <a href="readme.cpp">here</a>, and you can compile the code as follows:</p>
<div class="fragment"><div class="line">g++ -std=c++17 -O2 readme.cpp -o readme.o</div>
</div><!-- fragment --><p>As you can see in <a href="readme.cpp">readme.cpp</a>, to use epiworld you only need to incorporate the single header file <a href="epiworld.hpp">epiworld.hpp</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;epiworld.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>epiworld;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Creating a model with three statuses:</span></div>
<div class="line">    <span class="comment">// - Susceptible: Status 0</span></div>
<div class="line">    <span class="comment">// - Infected: Status 1</span></div>
<div class="line">    <span class="comment">// - Recovered: Status 2</span></div>
<div class="line">    <a class="code" href="class_model.html">Model&lt;&gt;</a> model;</div>
<div class="line">    model.add_status(<span class="stringliteral">&quot;Susceptible&quot;</span>, default_update_susceptible&lt;&gt;);</div>
<div class="line">    model.add_status(<span class="stringliteral">&quot;Infected&quot;</span>, default_update_exposed&lt;&gt;);</div>
<div class="line">    model.add_status(<span class="stringliteral">&quot;Recovered&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Desgining a virus: This virus will:</span></div>
<div class="line">    <span class="comment">// - Have a 90% transmission rate</span></div>
<div class="line">    <span class="comment">// - Have a 50% recovery rate</span></div>
<div class="line">    <span class="comment">// - Infected individuals become &quot;Infected&quot; (status 1)</span></div>
<div class="line">    <span class="comment">// - Recovered individuals become &quot;Recovered&quot; (status 2)</span></div>
<div class="line">    <span class="comment">// Only five individuals will have the virus from the beginning.</span></div>
<div class="line">    <a class="code" href="class_virus.html">Virus&lt;&gt;</a> virus(<span class="stringliteral">&quot;covid 19&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    virus.set_prob_infecting(.9);</div>
<div class="line">    virus.set_prob_recover(.5);</div>
<div class="line">    </div>
<div class="line">    virus.set_status(1, 2);</div>
<div class="line"> </div>
<div class="line">    model.add_virus_n(virus, 5);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Generating a random pop from a smallworld network</span></div>
<div class="line">    model.population_smallworld(100000);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initializing setting days and seed</span></div>
<div class="line">    model.init(100, 123);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Running the model</span></div>
<div class="line">    model.<a class="code" href="class_model.html#a825c7fb2498c7693cbf1bfcd0a416ef4">run</a>();</div>
<div class="line">    model.print();</div>
<div class="line">  </div>
<div class="line">}</div>
<div class="ttc" id="aclass_model_html"><div class="ttname"><a href="class_model.html">Model</a></div><div class="ttdoc">Core class of epiworld.</div><div class="ttdef"><b>Definition:</b> model-bones.hpp:77</div></div>
<div class="ttc" id="aclass_model_html_a825c7fb2498c7693cbf1bfcd0a416ef4"><div class="ttname"><a href="class_model.html#a825c7fb2498c7693cbf1bfcd0a416ef4">Model::run</a></div><div class="ttdeci">void run()</div><div class="ttdoc">Runs the simulation (after initialization)</div></div>
<div class="ttc" id="aclass_virus_html"><div class="ttname"><a href="class_virus.html">Virus</a></div><div class="ttdoc">Virus.</div><div class="ttdef"><b>Definition:</b> virus-bones.hpp:24</div></div>
</div><!-- fragment --><p>And you should get something like the following:</p>
<div class="fragment"><div class="line">Running the model...</div>
<div class="line">_________________________________________________________________________</div>
<div class="line">||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| done.</div>
<div class="line"> </div>
<div class="line">________________________________________________________________________________</div>
<div class="line">SIMULATION STUDY</div>
<div class="line"> </div>
<div class="line">Population size    : 100000</div>
<div class="line">Days (duration)    : 100 (of 100)</div>
<div class="line">Number of variants : 1</div>
<div class="line">Last run elapsed t : 134.00ms</div>
<div class="line">Rewiring           : off</div>
<div class="line"> </div>
<div class="line">Virus(es):</div>
<div class="line"> - covid 19 (baseline prevalence: 5 seeds)</div>
<div class="line"> </div>
<div class="line">Tool(s):</div>
<div class="line"> (none)</div>
<div class="line"> </div>
<div class="line">Model parameters:</div>
<div class="line"> (none)</div>
<div class="line"> </div>
<div class="line">Distribution of the population at time 100:</div>
<div class="line">- (0) Total Susceptible :  99995 -&gt; 95466</div>
<div class="line">- (1) Total Infected    :      5 -&gt; 70</div>
<div class="line">- (2) Total Recovered   :      0 -&gt; 4464</div>
</div><!-- fragment --><p>Which took about 0.134 seconds (~ 7.5 million ppl x day / second).</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Simulation Steps</h2>
<p>The core logic of the model relies on user-defined statuses and their corresponding update functions. In particular, the model does not have a predefined set of statuses, e.g., susceptible, infected, recovered; it is the user who establishes them. This provides a great deal of flexibility as models in <code>epiworld</code> can have an arbitrary set of statuses.</p>
<p>Like most other ABM, <code>epiworld</code> simulates the evolution of a system in discrete steps. Each step represents a day in the system, and changes are reflected at the beginning of the following day. Therefore, agents can become recovered and transmit a virus on the same day. A single step of <code>epiworld</code> features the following procedures:</p>
<ol type="1">
<li><b>Status update</b>: Agents are updated according to the status they are at.</li>
<li>(optional) <b>Execute global actions</b>: A call of user-defined functions affecting the system. These can make any type of change in the system.</li>
<li>(optional) <b>Apply rewiring algorithm</b>: When specified, the network is rewired according to a user-defined function.</li>
<li><b>Lock the results</b>: The current date is incremented in one unit and the changes (exposition, new infections, recoveries, etc.) are recorded in the database.</li>
<li>(optional) <b>Mutate Variants</b>: When defined, variants can mutate, with the new variants appearing the next day.</li>
</ol>
<p>To speed up computations, <code>epiworld</code> uses by default a queuing system that decides which agents will be active during each step and which will not. Agents are active when either they or at least one of their neighbors has a virus active. Agents' updates are triggered only for those who are in the queue, which in most cases accelerates the completion of the current step.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Agents</h2>
<p>Agents carry two sets of important information: viruses and tools. Each agent can have multiple instances of them, meaning that multiple viruses and tools can coexist in a model. At each step of the simulation, an agent can face the following changes:</p>
<ul>
<li>**Acquire a virus (<code>add_virus()</code>)**: Become exposed to a particular virus+host.</li>
<li>**Lose a virus (<code>rm_virus()</code>)**: Removing a virus from the agent. Losing a virus triggers a call to the virus's <code>postrecovery()</code> function, which can, for example, result in gaining immunity to that variant.</li>
<li>**Change status (<code>change_status()</code>)**: An arbitrary change in the status of the agent. Examples of this are moving from "exposed" to "infected," from "infected" to "ICU," etc.</li>
<li>**Become removed (<code>rm_agent_by_virus()</code>)**: An agent becomes inactive after its condition becoming worse. In such a case, all viruses attached to the agent are removed as well.</li>
</ul>
<p>Any action in the model can trigger a change in its queuing system. By default, becoming exposed makes the agent (and its neighbors) active in the queuing system. Likewise, losing all viruses could make the agent and its neighbors inactive.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Contagion</h2>
<p>Susceptible individuals can acquire a virus from any of their infected connections. The probability that susceptible individual <code>i</code> gets the virus <code>v</code> from individual <code>j</code> depends on how three things:</p>
<ol type="1">
<li>The transmissibility of the virus, <img src="https://render.githubusercontent.com/render/math?math=P_v%20%5Cin%20%5B0%2C1%5D" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/>,</li>
<li>The contagion reduction factor of <code>i</code>, <img src="https://render.githubusercontent.com/render/math?math=C_r%20%5Cin%20%5B0%2C1%5D" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/>, and</li>
<li>The host's transmission reduction factor, <img src="https://render.githubusercontent.com/render/math?math=T_r%20%5Cin%20%5B0%2C1%5D" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/>.</li>
</ol>
<p>The last two are computed from <img src="https://render.githubusercontent.com/render/math?math=i" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/> and <img src="https://render.githubusercontent.com/render/math?math=j" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/>'s tools. Ultimately, the probability of <img src="https://render.githubusercontent.com/render/math?math=i" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/> getting virus $v$ from <img src="https://render.githubusercontent.com/render/math?math=j" alt="" style="transform: translateY(0.1em); background: white;" class="inline"/> equals:</p>
<div align="center"><img src="https://render.githubusercontent.com/render/math?math=P(Virus%20v)%20%3D%20P_v%20*%20(1%20-%20C_r)%20*(1%20-%20T_r)%20" alt="" style="background: white;" class="inline"/></div><p>Nonetheless, the default behavior of the simulation model is to assume that individuals can acquire only one disease at a time, if any. This way, the actual probability is:</p>
<div align="center"><img src="https://render.githubusercontent.com/render/math?math=P(Virus%20v%7C%5Cmbox%7Bat%20most%20one%20virus%7D)%20%3D%20P_%7Bivj%7D" alt="" style="background: white;" class="inline"/></div><p>The latter is calculated using Bayes' rule</p>
<div align="center"><img src="https://render.githubusercontent.com/render/math?math=%5Cbegin%7Balign*%7D%0AP_%7Bivj%7D%20%26%20%3D%20P(at%20most%20one%20virus%7CVirus%20v)%20*%20P_v%20%2F%20P(at%20most%20one%20virus)%20%5C%5C%0A%20%20%20%20%20%20%20%20%26%20%3D%20P(Only%20Virus%20v)%2FP_v%20*%20P(Virus%20v)%20%2F%20P(at%20most%20one%20virus)%20%5C%5C%0A%20%20%20%20%20%20%20%20%26%20%3D%20P(Only%20Virus%20v)%2FP(at%20most%20one%20virus)%0A%5Cend%7Balign*%7D" alt="" style="background: white;" class="inline"/></div><p>Where</p>
<div align="center"><img src="https://render.githubusercontent.com/render/math?math=%5Cbegin%7Balign*%7D%0AP(Only%20Virus%20V)%20%20%20%20%20%20%26%20%3D%20P_v%20*%20%5Cprod_%7Bm!%3DV%7D%20(1%20-%20P_m)%20%5C%5C%0AP(at%20most%20one%20virus)%20%26%20%3D%20P(None)%20%2B%20%5Csum_%7Bk%20%5Cin%20viruses%7D%20P_k%20*%20%5Cprod_%7Bm%20!%3D%20k%7D%20(1%20-%20P_m)%20%5C%5C%0AP(None)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%20%3D%20%5Cprod_%7Bk%20%5Cin%20Viruses%7D%20(1%20-%20P_k)%0A%5Cend%7Balign*%7D" alt="" style="background: white;" class="inline"/></div><p>This way, viruses with higher transmissibility will be more likely to be acquired when competing with other variants. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
